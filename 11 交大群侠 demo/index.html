<!doctype html>
<meta charset="utf-8">
<title>交大</title>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0">
<!-- 这meta的作用就是删除默认的苹果工具栏和菜单栏 -->
<meta name="mobile-web-app-capable" content="yes">
<style>
  body {
    margin: 0; padding: 0;
    overflow: hidden;
    background-color: #000;
  }
</style>
<body>

  <script src="./js/pixi.min.js"></script>
  <script>

    PIXI.SCALE_MODES.DEFAULT = PIXI.SCALE_MODES.NEAREST;
  
    var w = 375;//这个是iphone6-x 的宽度
    var h = 600;
    var background;
    var app;

    //创建实例
    app = new PIXI.Application({ 
        width: w, 
        height: h,                       
        backgroundColor:0xffffff  
      }
    );
    app.view.style.position = "absolute"
    app.view.style.display = "block";
    document.body.appendChild(app.view);

    //创建容器（场景）
    var indexContainer  = new PIXI.Container();
    var gameContainer   = new PIXI.Container();
    var authorContainer = new PIXI.Container();

    //场景1绘制
    function stage1(){
        //创建背景图片
        background =new PIXI.Sprite(PIXI.loader.resources.background.texture);
        background.height = h;
        
        //创建标题文字
        var title = new PIXI.Text('新交大群侠传',{
          font: 'bold italic 50px Arial',
          fill: '#ffffff',
          stroke: '#000000',
          strokeThickness: 2
        });
        title.resolution = 2;
        title.anchor.set(.5)
        //注意，这里被坑了下，官方demo是没有resize的，所以用 app.screen.width 是可以的
        //其实我这里所有的定位，就根据最初的设定的w、h来进行处理就好
        //或者把 resize(); 放在这里之后。
        //title.x = app.screen.width/2;
        title.x = w/2;
        title.y = 100;

        //按钮文字1
        var btn1 = new PIXI.Text('开始游戏',{
          fontSize: 30
        });
        btn1.anchor.set(.5)
        btn1.x = w/2;
        btn1.y = 300;
        btn1.interactive = true;
        btn1.buttonMode = true;
        btn1.on('tap', function(){
          app.stage = gameContainer;
        });
        
        //按钮文字2
        var btn2 = new PIXI.Text('作者介绍',{
          fontSize: 30
        });
        btn2.anchor.set(.5)
        btn2.x = w/2;
        btn2.y = 400;
        btn2.interactive = true;
        btn2.buttonMode = true;
        btn2.on('tap', function(){
          app.stage = authorContainer;
        });

        indexContainer.addChild(background);
        indexContainer.addChild(title);
        indexContainer.addChild(btn1);
        indexContainer.addChild(btn2);
    }

    //场景2绘制
    function stage2(){   
        var btn = new PIXI.Text('游戏开始',{
          fontSize: 30,
          fill: 0x000,
          align: 'left'
        });
        btn.anchor.set(.5)
        btn.x = w/2;
        btn.y = 200;
        btn.interactive = true;
        btn.buttonMode = true;
        gameContainer.addChild(btn);
    }

    //场景3绘制
    function stage3(){

      // 如果加上下面这些，stage3被多次调用有重置场景的效果。看情况使用
      // authorContainer = new PIXI.Container();
      // resize();
      
      var btn = new PIXI.Text('作者是一个画家',{
        fontSize: 30,
        fill: 0x000,
        align: 'left'
      });
      btn.anchor.set(.5)
      btn.x = w/2;
      btn.y = 200;
      btn.interactive = true;
      btn.buttonMode = true;

      var btn2 = new PIXI.Text('返回首页',{
        fontSize: 30,
        fill: 0x000,
        align: 'left'
      });
      btn2.anchor.set(.5)
      btn2.x = w/2;
      btn2.y = 400;
      btn2.interactive = true;
      btn2.buttonMode = true;
      btn2.on('tap', function(){
        app.stage = indexContainer;
      });
      authorContainer.addChild(btn);
      authorContainer.addChild(btn2);
    }

    //缩放
    resize();

    //资源加载
    PIXI.loader
      .add("background", "background.png")
      .load(setup);

    //加载后回调
    function setup() {

      //完成3个场景的设置
      stage1();
      stage2();
      stage3();
      
      //这两个都可以用
      //app.stage.addChild(indexContainer);
      app.stage = indexContainer;
    }

    window.addEventListener('resize', resize);

    function resize(){
      //缩放
      ratio = Math.min(window.innerWidth/w,window.innerHeight/h);
      app.renderer.resize(Math.ceil(w * ratio),Math.ceil(h * ratio));      
      //所有的场景也要缩放
      indexContainer.scale.x = indexContainer.scale.y = ratio;
      gameContainer.scale.x = gameContainer.scale.y = ratio;
      authorContainer.scale.x = authorContainer.scale.y = ratio;
      //居中
      var ratio2 = w/h;
      if(window.innerWidth/window.innerHeight>w/h){
        app.view.style.top = 0
        app.view.style.left = (window.innerWidth-window.innerHeight*ratio2)/2+'px'
      }else{
        app.view.style.left = 0
        app.view.style.top = (window.innerHeight-window.innerWidth/ratio2)/2+'px'
      }

    }

  </script>
</body>

